<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store (Test Mode) | NextGenAdi4U</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style> body { -webkit-user-select: none; user-select: none; } </style>
    
    <style>
        :root { 
            --gold: #D4AF37; --dark: #0A0A0A; --bg: #FAFAFA; --text: #18181B; 
            --card-bg: #FFFFFF; --border: #E4E4E7;
        }
        body.dark-mode {
            --bg: #09090B; --text: #F4F4F5; --card-bg: #18181B; --border: #27272A;
        }

        body { 
            font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text);
            display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px;
        }

        /* HEADER */
        .header { width: 100%; max-width: 1000px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .back-btn { text-decoration: none; color: var(--text); font-weight: 600; display: flex; align-items: center; gap: 8px; padding: 10px 20px; background: var(--card-bg); border-radius: 50px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid var(--border); transition: 0.3s; }
        .back-btn:hover { color: var(--gold); border-color: var(--gold); transform: translateX(-5px); }
        .wallet-badge { background: var(--dark); color: var(--gold); padding: 8px 20px; border-radius: 50px; font-weight: bold; display: flex; align-items: center; gap: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        /* TOGGLE BUTTONS */
        .toggle-container { display: flex; background: var(--border); border-radius: 12px; padding: 5px; margin-bottom: 30px; }
        .toggle-btn { padding: 10px 25px; border: none; background: transparent; font-weight: 600; cursor: pointer; border-radius: 8px; color: #777; transition: 0.3s; }
        .toggle-btn.active { background: var(--card-bg); color: var(--dark); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

        /* GRID */
        .grid-container { display: none; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; max-width: 1000px; width: 100%; animation: fadeIn 0.5s ease; }
        .grid-container.active { display: grid; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* CARDS */
        .card { background: var(--card-bg); padding: 30px; border-radius: 16px; border: 1px solid var(--border); text-align: center; transition: 0.3s; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        .card:hover { transform: translateY(-8px); border-color: var(--gold); box-shadow: 0 15px 30px rgba(212, 175, 55, 0.1); }
        
        .card.premium { border: 2px solid var(--gold); background: linear-gradient(145deg, var(--card-bg), rgba(212,175,55,0.05)); }
        .badge { position: absolute; top: 15px; right: -30px; background: var(--gold); color: #fff; padding: 5px 40px; transform: rotate(45deg); font-size: 0.75rem; font-weight: bold; }

        .icon { font-size: 2.5rem; color: var(--gold); margin-bottom: 15px; }
        .plan-name { font-size: 1.3rem; font-weight: 800; margin-bottom: 5px; color: var(--text); }
        .price { font-size: 1.8rem; font-family: 'Cinzel'; font-weight: 700; color: var(--dark); margin: 10px 0; }
        .test-price { font-size: 0.9rem; color: #10B981; font-weight: bold; background: rgba(16, 185, 129, 0.1); padding: 2px 8px; border-radius: 4px; }
        
        .features { list-style: none; padding: 0; text-align: left; margin: 20px 0; flex-grow: 1; }
        .features li { font-size: 0.9rem; margin-bottom: 8px; color: var(--text); display: flex; gap: 8px; }
        .features li i { color: var(--gold); }

        .btn-buy { width: 100%; padding: 14px; background: var(--dark); color: var(--gold); border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: 0.3s; margin-top: auto; }
        .btn-buy:hover { background: var(--gold); color: var(--dark); transform: scale(1.02); }

        /* LOADER */
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); display: flex; justify-content: center; align-items: center; z-index: 9999; flex-direction: column; display: none; }
        .spinner { width: 40px; height: 40px; border: 4px solid #ddd; border-top: 4px solid var(--gold); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <p style="font-family:'Cinzel'; font-weight:bold;">Processing Transaction...</p>
    </div>

    <div class="header">
        <a href="dashboard.html" class="back-btn"><i class="fas fa-arrow-left"></i> Dashboard</a>
        <div class="wallet-badge"><i class="fas fa-coins"></i> <span id="currentCredits">...</span></div>
    </div>

    <div style="text-align:center; margin-bottom:20px;">
        <h1 style="font-family:'Cinzel'; margin:0;">Store</h1>
        <p style="color:#10B981; font-weight:bold; font-size:0.9rem;">‚óè TEST MODE ACTIVE (‚Çπ0 Payment)</p>
    </div>

    <div class="toggle-container">
        <button class="toggle-btn active" onclick="switchTab('credits', this)">Credit Packs</button>
        <button class="toggle-btn" onclick="switchTab('memberships', this)">Memberships</button>
    </div>

    <div class="grid-container active" id="credits-grid">
        <div class="card">
            <div class="icon"><i class="fas fa-coins"></i></div>
            <div class="plan-name">Mini Pack</div>
            <div class="price">‚Çπ49 <span class="test-price">FREE</span></div>
            <ul class="features"><li><i class="fas fa-check-circle"></i> <b>500</b> Credits</li><li><i class="fas fa-check-circle"></i> Instant Delivery</li></ul>
            <button class="btn-buy" onclick="buyItem('credit', 'Mini Pack', 500, 49)">Buy Now</button>
        </div>
        <div class="card">
            <div class="icon"><i class="fas fa-coins"></i></div>
            <div class="plan-name">Basic Pack</div>
            <div class="price">‚Çπ99 <span class="test-price">FREE</span></div>
            <ul class="features"><li><i class="fas fa-check-circle"></i> <b>600</b> Credits</li><li><i class="fas fa-check-circle"></i> Standard Access</li></ul>
            <button class="btn-buy" onclick="buyItem('credit', 'Basic Pack', 600, 99)">Buy Now</button>
        </div>
        <div class="card popular">
            <div class="badge">HOT</div>
            <div class="icon"><i class="fas fa-layer-group"></i></div>
            <div class="plan-name">Standard Pack</div>
            <div class="price">‚Çπ199 <span class="test-price">FREE</span></div>
            <ul class="features"><li><i class="fas fa-check-circle"></i> <b>1500</b> Credits</li><li><i class="fas fa-check-circle"></i> Best for Beginners</li></ul>
            <button class="btn-buy" onclick="buyItem('credit', 'Standard Pack', 1500, 199)">Buy Now</button>
        </div>
        <div class="card">
            <div class="icon"><i class="fas fa-cubes"></i></div>
            <div class="plan-name">Pro Pack</div>
            <div class="price">‚Çπ599 <span class="test-price">FREE</span></div>
            <ul class="features"><li><i class="fas fa-check-circle"></i> <b>4000</b> Credits</li><li><i class="fas fa-check-circle"></i> High Value</li></ul>
            <button class="btn-buy" onclick="buyItem('credit', 'Pro Pack', 4000, 599)">Buy Now</button>
        </div>
        <div class="card premium">
            <div class="badge">MAX</div>
            <div class="icon"><i class="fas fa-gem"></i></div>
            <div class="plan-name">Ultimate Pack</div>
            <div class="price">‚Çπ999 <span class="test-price">FREE</span></div>
            <ul class="features"><li><i class="fas fa-check-circle"></i> <b>9000</b> Credits</li><li><i class="fas fa-check-circle"></i> Massive Savings</li></ul>
            <button class="btn-buy" onclick="buyItem('credit', 'Ultimate Pack', 9000, 999)">Buy Now</button>
        </div>
    </div>

    <div class="grid-container" id="memberships-grid">
        <div class="card">
            <div class="icon"><i class="fas fa-star"></i></div>
            <div class="plan-name">Plus Member</div>
            <div class="price">‚Çπ299 <span class="test-price">FREE</span></div>
            <ul class="features">
                <li><i class="fas fa-gift"></i> <b>1000</b> Bonus Credits</li>
                <li><i class="fas fa-tag"></i> <b>20% OFF</b> Lifetime (Credits)</li>
                <li><i class="fas fa-check"></i> One-time Payment</li>
            </ul>
            <button class="btn-buy" onclick="buyItem('membership', 'Plus Member', 1000, 299, 20)">Join Now</button>
        </div>
        <div class="card popular">
            <div class="badge">BEST</div>
            <div class="icon"><i class="fas fa-crown"></i></div>
            <div class="plan-name">Pro Member</div>
            <div class="price">‚Çπ599 <span class="test-price">FREE</span></div>
            <ul class="features">
                <li><i class="fas fa-gift"></i> <b>3500</b> Bonus Credits</li>
                <li><i class="fas fa-tag"></i> <b>40% OFF</b> Lifetime (Credits)</li>
                <li><i class="fas fa-check"></i> One-time Payment</li>
            </ul>
            <button class="btn-buy" onclick="buyItem('membership', 'Pro Member', 3500, 599, 40)">Join Now</button>
        </div>
        <div class="card premium">
            <div class="badge">KING</div>
            <div class="icon"><i class="fas fa-dragon"></i></div>
            <div class="plan-name">Ultimate Member</div>
            <div class="price">‚Çπ1099 <span class="test-price">FREE</span></div>
            <ul class="features">
                <li><i class="fas fa-gift"></i> <b>7000</b> Bonus Credits</li>
                <li><i class="fas fa-tag"></i> <b>70% OFF</b> Lifetime (Credits)</li>
                <li><i class="fas fa-check"></i> One-time Payment</li>
            </ul>
            <button class="btn-buy" onclick="buyItem('membership', 'Ultimate Member', 7000, 1099, 70)">Join Now</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, updateDoc, increment, getDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // üî• FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBE4rNCK5MR1Joy-EOJgWgMLqmm6QDEH40",
            authDomain: "premium-6172b.firebaseapp.com",
            projectId: "premium-6172b",
            storageBucket: "premium-6172b.firebasestorage.app",
            messagingSenderId: "1024825846032",
            appId: "1:1024825846032:web:93209b4ca94480da32dd95",
            measurementId: "G-QGEW9H7NST"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let currentUser = null;
        let userData = null;

        // üö® TELEGRAM DETAILS
        const TG_TOKEN = "8336599171:AAFNKIKQ_3DBOLO9HHpkgFoFHXd2NO2NOAE"; 
        const TG_CHAT_ID = "8255824096"; 

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                const snap = await getDoc(doc(db, "users", user.uid));
                if(snap.exists()) {
                    userData = snap.data();
                    document.getElementById("currentCredits").innerText = userData.credits;
                }
            } else {
                window.location.replace("index.html");
            }
        });

        window.switchTab = function(tab, btn) {
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.grid-container').forEach(g => g.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById(tab + '-grid').classList.add('active');
        }

        // üß™ MAIN PURCHASE FUNCTION (Test Mode)
        window.buyItem = async function(type, name, creditValue, cost, discountPercent = 0) {
            if (!currentUser) return;
            document.getElementById('loader').style.display = 'flex';

            // Simulate Delay
            setTimeout(async () => {
                try {
                    const userRef = doc(db, "users", currentUser.uid);
                    let updates = {};
                    let alertMsg = "";

                    // 1. CREDIT PACK LOGIC
                    if (type === 'credit') {
                        updates = {
                            credits: increment(creditValue),
                            transactions: arrayUnion({ item: name, amount: cost, credits: creditValue, date: new Date().toISOString(), type: 'Purchase' })
                        };
                        alertMsg = `${creditValue} Credits added!`;

                        // üí∞ REFERRAL COMMISSION (20% for Credits)
                        if (userData.referredBy) {
                            await giveCommission(userData.referredBy, Math.floor(creditValue * 0.20), 'Credit Commission', currentUser.displayName);
                        }
                    } 
                    
                    // 2. MEMBERSHIP LOGIC
                    else if (type === 'membership') {
                        updates = {
                            credits: increment(creditValue), // Bonus
                            planType: name,
                            discountMultiplier: (100 - discountPercent) / 100, // Saves 0.8, 0.6, 0.3
                            transactions: arrayUnion({ item: name, amount: cost, credits: creditValue, date: new Date().toISOString(), type: 'Membership' })
                        };
                        alertMsg = `Welcome to ${name}! +${creditValue} Bonus Added.`;

                        // üí∞ REFERRAL COMMISSION (10% for Membership - on Bonus Credits)
                        if (userData.referredBy) {
                            await giveCommission(userData.referredBy, Math.floor(creditValue * 0.10), 'Membership Commission', currentUser.displayName);
                        }
                    }

                    // EXECUTE UPDATE
                    await updateDoc(userRef, updates);
                    
                    // NOTIFY ADMIN
                    sendTelegramAlert(`üí∞ <b>New Purchase (Test)</b>`, `üë§ User: ${currentUser.displayName}\nüì¶ Item: ${name}\nüí∏ Cost: ‚Çπ${cost} (Paid ‚Çπ0)\nüíé Credits Added: ${creditValue}`);

                    document.getElementById('loader').style.display = 'none';
                    Swal.fire({ title: 'Success!', text: alertMsg, icon: 'success' }).then(() => location.reload());

                } catch (error) {
                    console.error(error);
                    document.getElementById('loader').style.display = 'none';
                    Swal.fire('Error', 'Transaction Failed', 'error');
                }
            }, 1500);
        }

        // ü§ù COMMISSION FUNCTION
        async function giveCommission(referrerId, amount, type, buyerName) {
            try {
                const refRef = doc(db, "users", referrerId);
                await updateDoc(refRef, {
                    credits: increment(amount),
                    referralLogs: arrayUnion({
                        type: 'commission',
                        buyerName: buyerName,
                        earnedCredits: amount,
                        date: new Date().toISOString()
                    })
                });
            } catch (e) { console.log("Commission Error", e); }
        }

        async function sendTelegramAlert(title, details) {
            try {
                await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: TG_CHAT_ID, text: `üîî ${title}\n\n${details}`, parse_mode: "HTML" })
                });
            } catch (e) {}
        }
    </script>
</body>
</html>
